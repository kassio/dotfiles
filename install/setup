#!/usr/bin/env bash


export DOTFILES="${HOME}/.dotfiles"
export INSTALLER="${DOTFILES}/install"

pushd ${HOME} > /dev/null && trap 'popd > /dev/null' EXIT HUP INT QUIT TERM

# Check for software updates
softwareupdate -ia

# Install XCode
xcode-select --install
sudo xcodebuild -license accept

${INSTALLER}/basic-packages
${INSTALLER}/rcfiles
${INSTALLER}/init-ssh-config

# Load some of my env
source ${DOTFILES}/lib/env

# Change my shell to zsh
chsh -s $(type -ap zsh | grep $(brew --prefix))

# Install ruby
${INSTALLER}/ruby

# Install linters
update-linters

# install iterm2 integration
curl -L https://iterm2.com/misc/bash_startup.in -o ${HOME}/.iterm2_shell_integration.bash
curl -L https://iterm2.com/misc/zsh_startup.in -o ${HOME}/.iterm2_shell_integration.zsh

# Installing all my stuff
brew bundle --global

# Customize OSX
${INSTALLER}/osx

# Use key backspace instead of ^H
infocmp ${TERM} | sed 's/kbs=^[hH]/kbs=\\177/' > ${TERM}.ti
tic ${TERM}.ti

# Twitter app show the app window when clicking the menu bar icon
defaults write com.twitter.twitter-mac MenuItemBehavior -int 1

# Init postgres
brew services start --all
init-pg

exit 0
