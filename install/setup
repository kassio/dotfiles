#!/usr/bin/env bash

source "$(dirname $0)/global"

pushd ${HOME} > /dev/null && trap 'popd > /dev/null' EXIT HUP INT QUIT TERM

# Check for software updates
softwareupdate -ia

# Install XCode
xcode-select --install
sudo xcodebuild -license accept

${INSTALLER}/basic-packages
${INSTALLER}/setup-shell
${INSTALLER}/rcfiles
source ${DOTFILES}/lib/env
${INSTALLER}/ruby

# Installing all my stuff
update-linters & brew bundle --global

# Init postgres
brew services start --all
init-pg

# install iterm2 integration
curl -L https://iterm2.com/misc/bash_startup.in -o ${HOME}/.iterm2_shell_integration.bash
curl -L https://iterm2.com/misc/zsh_startup.in -o ${HOME}/.iterm2_shell_integration.zsh

# Use key backspace instead of ^H
infocmp ${TERM} | sed 's/kbs=^[hH]/kbs=\\177/' > /tmp/${TERM}.ti
tic /tmp/${TERM}.ti

# Customize OSX
${INSTALLER}/osx

exit 0
