#!/usr/bin/env bash

source "$(dirname $0)/global"

pushd ${HOME} > /dev/null && trap 'popd > /dev/null' EXIT HUP INT QUIT TERM

# Check for software updates
softwareupdate -ia

# Install XCode
xcode-select --install
sudo xcodebuild -license accept

${INSTALLER}/basic-packages
${INSTALLER}/setup-shell
${INSTALLER}/rcfiles
${INSTALLER}/ruby
source ${DOTFILES}/lib/env

# Installing all my stuff
brew bundle --global

# Init postgres
brew services start --all
init-pg

# install iterm2 integration
update-iterm2-integrations

# Use key backspace instead of ^H
infocmp ${TERM} | sed 's/kbs=^[hH]/kbs=\\177/' > /tmp/${TERM}.ti
tic /tmp/${TERM}.ti

# Customize OSX
${INSTALLER}/macos/setup

exit 0
