#!/usr/bin/env zsh

source "${HOMEBREW_PREFIX}/opt/asdf/asdf.sh"

previous=$(asdf current ruby)

while read -r rb
do
  eval "asdf shell ruby ${rb} 2>/dev/null"
  echo "with ruby: $(asdf current ruby)"

  if ! eval "$*"
  then
    echo "$* failed for ${rb}"
    continue
  fi
done < <(asdf list ruby 2>/dev/null)

asdf shell ruby "${previous}"
