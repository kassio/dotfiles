#!/usr/bin/env bash

set -e

OIFS=$IFS
IFS='\n'
versions=($(rbenv versions --bare))
IFS=$OIFS
versions+=("system")

for rb in ${versions[@]}
do
  export RBENV_VERSION=${rb}
  echo "with ruby: $(rbenv version-name)"

  if ! eval "$@"
  then
    echo "$@ failed for ${rb}"
    continue
  fi
done

unset RBENV_VERSION
