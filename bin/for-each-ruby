#!/usr/bin/env bash

set -e

OIFS=$IFS
IFS='\n'
versions=($(asdf list ruby))
previous=$(asdf current ruby)
IFS=$OIFS

for rb in ${versions[@]}
do
  asdf shell ruby ${rb}
  echo "with ruby: $(asdf current ruby)"

  if ! eval "$@"
  then
    echo "$@ failed for ${rb}"
    continue
  fi
done

asdf shell ruby ${previous}
