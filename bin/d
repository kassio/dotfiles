#!/usr/bin/env bash

docker_ps() {
  local id="$1"
  local name='{{.Name}}'
  local status='{{if .State.Running}} Running {{else}} Stopped {{end}}'
  local ips='{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}'
  local target_ports='{{range $t := $target}} -> {{$t.HostPort}},{{end}}'
  local ports='{{range $origin, $target := .NetworkSettings.Ports}} {{$origin}}'$target_ports'{{end}}'
  local format="$name##$id##$status##$ips##$ports"

  docker ps -q \
    | xargs -Icontainer docker inspect --format="$format" $@ container \
    | sed -e "s#^/##" \
    | sed -e "s#,\$##" \
    | column -t -s'##' \
    | sort
}

case $@ in
  log|logs|l)
    docker ps -q | xargs -Icontainer docker logs -f container
    ;;
  ps)
    docker_ps
    ;;
  stop)
    docker ps -q | xargs -Icontainer docker stop container
    ;;
  rmiall|rmia)
    docker images -q | xargs -Iimage docker rmi --force image
    ;;
  *)
    docker $@
    ;;
esac
