#!/usr/bin/env zsh

title "[nvim] update nvim"
if [ "${1}" = "-h" ] || [ "${1}" = "--help" ]; then
  exit
fi

_nvim() {
  nvim \
    --cmd "lua vim.deprecate = function() end" \
    --cmd "lua vim.notify_once = vim.notify_once or function() end" \
    "$@"
}

echo ""
subtitle "install nvim-nightly"
"${DOTFILES}/installers/nvim-nightly"

echo ""
subtitle "update nvim plugins"
_nvim --headless "+Lazy! update" +qa

echo ""
subtitle "update treesitter"
_nvim --headless "+TSUpdateSync" +qa

echo ""
subtitle "update lsp/lint/formatter/debugger tools"
_nvim --headless "+LspToolsUpdate" +qa

echo ""
subtitle "ensure Gitlab.vim is installed"
_nvim --headless "+setf ruby" "+GitLabCodeSuggestionsInstallLanguageServer" +qa
