#!/usr/bin/env bash

pushd "$1" > /dev/null \
  && trap 'popd > /dev/null' EXIT HUP INT QUIT TERM


find "${PWD}" -mindepth 1 -maxdepth 1 -type d \
  | sort -u \
  | while IFS= read -r repo
do
  if [ -d "${repo}/.git" ]
  then
    cd "${repo}" &>/dev/null || exit 1
    target=${PWD%% }
    remote=$(git remote get-url --push origin)

    if [ -n "$remote" ]
    then
      echo "${remote}|${target/${HOME}/\$HOME}"
    fi

    cd - &>/dev/null || exit 1
  fi
done
